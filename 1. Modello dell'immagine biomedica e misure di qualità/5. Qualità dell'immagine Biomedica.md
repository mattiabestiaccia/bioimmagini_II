---
tags:
  - qualit√†-immagine
  - SNR
  - CNR
  - phantom
  - quality-assessment
  - JND
  - acutance
  - PSF
  - rumore-riciano
  - artefatti
aliases:
  - Qualit√† Immagine Biomedica
  - Metriche di Qualit√†
  - SNR e CNR
---

> [!nav]- Navigazione
> **Precedente:** [[4. Modello dell'Immagine Biomedica|‚Üê Modello Immagine]] | [[INDICE|üìë Indice]] | **Successivo:** [[6. Case Study - Bando CONSIP per Scanner MRI|Case Study CONSIP ‚Üí]]

## Qualit√† dell'Immagine Biomedica

> [!important] Metriche di Qualit√†
> Questo documento descrive le metriche quantitative per valutare la qualit√† delle immagini biomediche.
>
> **Prerequisiti:**
> - [[4. Modello dell'Immagine Biomedica|Modello dell'Immagine]] (concetti di rumore, PVE, attenuazione)
> - [[2. Definizione di Immagine Biomedica|Definizione Immagine]]
>
> **Applicazioni pratiche:**
> - [[6. Case Study - Bando CONSIP per Scanner MRI|Case Study CONSIP]] (esempio reale di quality assessment)

### Introduzione alla Valutazione della Qualit√†

Il fine di un'immagine biomedica √® permettere una **diagnosi accurata** da parte del medico.

**Problematica della definizione:**
- La qualit√† dell'immagine biomedica non √® facilmente definibile
- Forte **soggettivit√†** nell'utilizzo dell'immagine per la diagnosi
- Impossibilit√† di descrizione rigorosa del processo decisionale

**Importanza della qualit√†:**
Essenziale nella progettazione e **quality assessment** dei dispositivi biomedici

### Uso di Phantom per la Misura Oggettiva

Per rendere pi√π oggettiva la misura di qualit√† si utilizzano **phantom** (fantocci).

**Caratteristiche dei phantom:**
- Costruiti in modo **riproducibile**
- Permettono **misure ripetute**
- Escludono la variabilit√† dovuta al paziente

**Standardizzazione:**
Le macchine per l'acquisizione di immagini biomediche hanno in dotazione uno o pi√π **phantom standardizzati** per il quality assessment periodico.

## Valutazione Qualitativa o Semi-quantitativa

La valutazione viene effettuata da un **operatore esperto** utilizzando scale standardizzate.

**Scala a cinque punti tipica:**
1. Nondiagnostic study
2. Poor or suboptimal study
3. Acceptable
4. Good
5. Excellent

**Caratteristiche della valutazione:**
- Fortemente **dipendente dall'operatore**
- Per minimizzare la variabilit√†: coinvolgere pi√π operatori
- Mediare i risultati ed eliminare i valori estremi
- Qualit√† espressa da numero compreso tra 1 e 5 (anche frazionario)

**Processo di valutazione:**
- Analisi di un certo numero di immagini da parte di operatori esperti
- Attribuzione di punteggio di qualit√†
- Media o mediana dei punteggi = indice di qualit√† dell'immagine

## SNR e CNR

L'**SNR** (Signal-to-Noise Ratio) e il **CNR** (Contrast-to-Noise Ratio) sono parametri di qualit√† largamente utilizzati nella valutazione delle immagini.

### Modello Semplificato dell'Immagine

L'immagine reale √® data dalla somma dell'immagine ideale e del rumore (vedi [[4. Modello dell'Immagine Biomedica#Fattori di Corruzione dell'Immagine|Modello Completo]]):
$$I(x, y) = I_0(x, y) + n(x, y)$$

Dove:
- $I(x, y)$: immagine acquisita
- $I_0(x, y)$: immagine ideale
- $n(x, y)$: rumore (gaussiano con media nulla e deviazione standard $\sigma$)

**Esempio con phantom MRI:**
- Immagine ideale: tre regioni con $s_1=50$, $s_2=150$, $s_3=200$
- Immagine corrotta: stesso phantom con rumore $\sigma=10$
- Phantom costituito da due cilindri concentrici in plastica con liquidi diversi

![[Pasted image 20251129162319.png]]

**Effetto del rumore:**
Il rumore allarga la distribuzione del segnale dei vari tessuti, fino a confondere pixel di tessuti diversi. Maggiore √® $\sigma$ rispetto al segnale, peggiore √® la qualit√† dell'immagine.

### Signal-to-Noise Ratio (SNR)

**Definizione:**
$$\text{SNR} = \frac{M_i}{\sigma_i}$$

Dove:
- $M_i$: valor medio del segnale in una regione
- $\sigma_i$: deviazione standard del rumore nella stessa regione

**Significato:**
Misura di quanto il valore del segnale √® corrotto dal rumore.

**Dipendenze dell'SNR:**
- **Risoluzione dell'immagine:** voxel pi√π piccoli ‚Üí meno segnale acquisito ‚Üí $M$ pi√π piccolo ‚Üí SNR diminuisce
- **Tempo di acquisizione:** maggior tempo ‚Üí $M$ aumenta ‚Üí SNR aumenta
- **SNR ottimo:** compromesso tra qualit√† immagine, tempo di acquisizione e risoluzione

### Contrast-to-Noise Ratio (CNR)

Nell'uso clinico √® pi√π importante il **contrasto**, cio√® la capacit√† di distinguere due tessuti diversi.

**Definizione:**
![[Pasted image 20251129162425.png]]

$$\text{CNR} = \frac{|M_1 - M_2|}{\sqrt{\frac{\sigma_1^2 + \sigma_2^2}{2}}}$$

Dove:
- $M_1, M_2$: valori medi del segnale nelle due regioni
- $\sigma_1, \sigma_2$: deviazioni standard del rumore nelle due regioni

### Metodi di Misura di SNR e CNR

#### Metodo Manuale con ROI

La misura viene effettuata tracciando **Regioni di Interesse** (ROI) sull'immagine.

**Requisiti:**
- ROI in regioni **omogenee** dell'immagine
- Area ROI maggiore ‚Üí maggiore precisione
- ROI lontane dai bordi dei tessuti (evitare **PVE**)
- ROI troppo grandi possono includere fenomeni di **attenuazione**

#### Metodo con Immagini Doppie

Per ottimizzare la misura si acquisiscono **due immagini dello stesso oggetto** con stessi parametri:

![[Pasted image 20251129162453.png]]

**Principio:**
L'immagine ideale non cambia, sottraendo le due immagini:

![[Pasted image 20251129162509.png]]

$$I_d(x,y) = I_1(x,y) - I_2(x,y) = n_1(x,y) - n_2(x,y) = n_d(x,y)$$

**Stima del rumore:**
- La differenza $n_d(x,y)$ non √® in generale gaussiana
- Stima superiore della SD: $\sigma_d \approx 2\sigma$
- Misurando SD su immagine differenza e dividendo per 2 ‚Üí misura oggettiva del limite superiore del rumore

**Vantaggi:**
- Misura su tutta l'immagine ‚Üí migliore qualit√†
- Facilmente automatizzabile

**Limitazioni:**
- Utilizzabile solo su **phantom** (oggetti inanimati)
- Non applicabile su pazienti (impossibile avere immagini identiche per il movimento)

#### Metodo Automatico con Regioni Multiple

Un altro metodo automatico prevede l'estrazione dall'immagine di una serie di regioni (es. quadrati 16√ó16 pixel).

**Procedura:**
1. Estrarre le regioni
2. Calcolare la SD per ogni regione
3. Ordinare per SD crescente
4. Eliminare regioni con SD pi√π alto (presenza di pi√π tessuti)
5. SD rimasto ‚Üí rappresentativo del rumore

### Misura su Immagini Reali: Problema del Rumore Biologico

Quando si esaminano immagini di pazienti reali, i tessuti **non sono omogenei** come nel modello ideale, ma presentano una struttura interna (fibre muscolari, etc.).

**Rumore biologico:**
Variabilit√† non dovuta al rumore di acquisizione ma alla **struttura stessa dell'oggetto** (vedi [[4. Modello dell'Immagine Biomedica#1. Rumore Biologico $n_B(x,y)$|Rumore Biologico nel Modello]]).

**Soluzione:**
Stimare il rumore sullo **sfondo dell'immagine**, dove non √® presente alcun tessuto.

**Assunzione:**
![[Pasted image 20251129162530.png]]

Se $\sigma$ √® costante, la SD del rumore √® la stessa su tutti i tessuti e quindi anche sul fondo.

**Formule utilizzate:**
![[Pasted image 20251129162547.png]]

$$\text{SNR} = \frac{M_{\text{tessuto}}}{\sigma_{\text{fondo}}}$$

$$\text{CNR} = \frac{|M_1 - M_2|}{\sigma_{\text{fondo}}}$$

Dove:
- Valor medio misurato su ROI nel tessuto di interesse
- SD misurata su ROI nel fondo dell'immagine

**Nota critica:**
Questa tecnica √® apprezzata dai produttori perch√© ottiene valori SNR/CNR **superiori** a quelli reali visti dall'operatore. √à valida solo se il rumore √® di tipo **additivo**.

### Caso Particolare: Rumore Riciano in MRI

Nelle immagini **MRI** il rumore non √® additivo ma **moltiplicativo** (distribuzione Riciana).

**Processo di formazione immagine MRI:**
Le immagini sono ricostruite dal **K-spazio** (dominio della frequenza).

**Canali di demodulazione:**
- Parte reale e immaginaria del K-spazio
- Due canali: fase e quadratura
- Rumore di acquisizione: gaussiano bianco con SD uguale sui due canali

**Trasformata di Fourier inversa:**
$$c(k,l) = p(k,l) + jq(k,l) + n_p(k,l) + jn_q(k,l)$$

Dove:
- $p, q$: parte reale e immaginaria dell'immagine ideale
- $n_p, n_q$: rumore sui due canali

**Modulo dell'immagine:**
![[Pasted image 20251129162622.png]]

$$|c(k,l)| = \sqrt{[p(k,l) + n_p(k,l)]^2 + [q(k,l) + n_q(k,l)]^2}$$

![[Pasted image 20251129162636.png]]

**Effetto della non linearit√†:**
La distribuzione del rumore diventa di tipo **Riciano** (non pi√π gaussiano).

**Approssimazione per alto SNR:**
Quando il segnale √® molto maggiore del rumore:

![[Pasted image 20251129162652.png]]

$$|c| \approx \sqrt{p^2 + q^2} + \frac{pn_p + qn_q}{\sqrt{p^2 + q^2}} = m + n_z$$

Dove:
- $m = \sqrt{p^2 + q^2}$: modulo dell'immagine ideale
- $n_z$: rumore additivo

**Deviazione standard del rumore:**
![[Pasted image 20251129162705.png]]

$$\sigma_{n_z} = \sigma$$

In regioni di **elevata intensit√†** il rumore √® gaussiano con SD uguale alla SD sui due canali.

**Rumore sullo sfondo:**
Nelle regioni a bassa intensit√† (sfondo), la distribuzione Riciana √® simile alla distribuzione di **Rayleigh**.

Per sfondo con segnale nullo:

![[Pasted image 20251129162717.png]]

$$\sigma_{\text{sfondo}} = 0.655 \sigma$$

**Conseguenza:**
Misurando il rumore sullo sfondo si ottiene una **sottostima** di un fattore **1.526** (per bobina a singolo canale; il fattore cambia per bobine multicanale).

**Formula corretta per MRI:**
![[Pasted image 20251129162731.png]]

$$\text{SNR}_{\text{MRI}} = \frac{M_{\text{tessuto}}}{1.526 \cdot \sigma_{\text{fondo}}}$$

$$\text{CNR}_{\text{MRI}} = \frac{|M_1 - M_2|}{1.526 \cdot \sigma_{\text{fondo}}}$$

**Nota:**
Questa tecnica √® meno apprezzata dai produttori perch√© ottiene valori SNR/CNR **inferiori** rispetto all'assunzione di rumore additivo.

### Conclusioni su SNR e CNR

**Importanza della fisica di acquisizione:**
Nella valutazione del rumore √® fondamentale tener conto della **fisica dell'acquisizione** per una valutazione corretta.

**Confronto tra dispositivi:**
√à importante conoscere la **procedura utilizzata** per la misura di SNR e CNR quando si confrontano dispositivi diversi.

## JND (Just Noticeable Difference)

L'indice **JND** indica il valore di incremento relativo del segnale rispetto allo sfondo dopo il quale un oggetto diventa **visibile**.

**Definizione:**
$$\text{JND} = \frac{F - B}{B}$$

Dove:
- $B$: segnale dello sfondo
- $F$: segnale dell'oggetto

**Weber Law:**
Il valore di JND √® largamente **indipendente** dal valore di $B$ e vale intorno al **2%** (in assenza di rumore).

**Casi reali:**
Nei casi reali $F$ e $B$ sono **stime** ottenute come media su ROI, quindi il JND utile per distinguere i due tessuti sar√† **pi√π alto**.

![[Pasted image 20251129162758.png]]

**Esempio:**
Nella figura √® riportato un esperimento tipico per la valutazione del JND; la prima barra ha un JND del 3%.

### Test JND con Phantom TAC

Alcuni fantocci TAC implementano il test JND includendo una serie di **inserti con valori JND crescenti**.

**Procedura del test:**
- Riconoscimento del numero massimo possibile di inserti da parte dell'operatore
- Risultato dipende da: acume visivo, monitor, illuminazione ambientale, etc.

**Limitazione:**
I risultati hanno un certo grado di **soggettivit√†**.

## Analisi dei Profili

Per valutare il **PVE** ([[4. Modello dell'Immagine Biomedica#2. Effetto del Volume Parziale (PVE)|Partial Volume Effect]]) √® possibile estrarre dall'immagine un **profilo**: grafico dell'intensit√† di segnale rispetto a una direzione.

**Preferenza:**
Si estraggono profili lungo le **coordinate principali** (x, y, z) per evitare problemi di interpolazione.

### Esempio: Immagine Ideale

Consideriamo un'immagine ideale costituita da sfondo di valore 50 con quadrato interno di valore 255.

![[Pasted image 20251129162839.png]]

**Profilo lungo x:**
Il grafico presenta **due transizioni istantanee**.

![[Pasted image 20251129162850.png]]

### Parametri di Qualit√† dal Profilo

Un parametro di qualit√† dovrebbe essere correlato a:
- **Intervallo spaziale** $(b-a)$ in cui avviene la transizione
- **Altezza del gradino** $f(b) - f(a)$

**Gradiente:**
$$G_x = \frac{f(b) - f(a)}{b - a}$$

Gradiente maggiore ‚Üí contorni meglio definiti ‚Üí immagine di migliore qualit√†.

**Problema del gradiente:**
Higgins e Jones hanno verificato che il gradiente **non correla bene** con la percezione visiva umana.

### Acutance (Acutezza)

√à stato proposto il parametro **acutance** che correla meglio con la percezione visiva della definizione dei contorni.

**Definizione:**
![[Pasted image 20251129162914.png]]

$$\text{Acutance} = \frac{[f(b) - f(a)]^2}{b - a}$$

**Requisiti di misura:**
- Ripetere misure in **varie direzioni**
- Ripetere su **varie interfacce** tra tessuti

**Definizione di a e b:**
- Immagine ideale senza rumore: facile (valore soglia esatto)
- Immagini reali con rumore: necessaria **soglia** per stabilire inizio e fine transizione

### Point Spread Function (PSF)

Concetto fortemente connesso all'acutezza: la **PSF** rappresenta l'immagine reale di un punto singolo.

**Definizione:**
Funzione di trasferimento del processo di formazione reale dell'immagine.

**Interpretazione matematica:**
Se definiamo un punto ideale come delta di Dirac, l'immagine reale in uscita sar√† la PSF del sistema.

**Sistema LSI (Linear Space-Invariant):**
$$g = \text{PSF} * f$$

Dove:
- $f$: immagine ideale
- $g$: immagine reale
- $*$: convoluzione spaziale

**Forma tipica:**
La PSF √® di solito una **gaussiana 2D**, giustificando l'uso della convoluzione gaussiana nel modello dell'immagine biomedica per il PVE.

**Misura della PSF:**
- Imaging di oggetto puntiforme (o di dimensioni molto piccole)
- Tracciare profili della PSF risultante (funzioni gaussiane)
- **Larghezza dei profili** (SD della gaussiana) ‚Üí misura della bont√† del sistema

**Requisiti:**
- Uso di **fantoccio standardizzato**
- Procedura di imaging standardizzata

### Valutazione del Campo di Attenuazione

Un profilo tracciato su immagine di fantoccio **omogeneo** che riempia tutto o buona parte del FOV pu√≤ permettere di valutare il **campo di attenuazione** $g$.

**Interpretazione:**
- $g = 1$ (assenza di attenuazione): profilo perfettamente orizzontale
- $g < 1$: compare **curvatura** del profilo, tanto maggiore quanto maggiore √® l'attenuazione

## Artefatti

Le immagini biomediche possono essere corrotte da **artefatti**: strutture riconoscibili che appaiono sull'immagine anche se non esistono nell'oggetto reale.

**Differenza con il rumore:**
- **Rumore:** disturbo completamente casuale, privo di struttura, distribuito uniformemente
- **Artefatti:** strutture con coerenza interna, predicibili

**Valutazione:**
Gli artefatti sono tipicamente **non predicibili** e vengono valutati attraverso la **probabilit√† della loro comparsa** su lunghe serie di acquisizioni.

**Cause:**
Alcuni artefatti possono essere dovuti a:
- **Motivi fisiologici:** respiro del paziente, irregolarit√† del segnale ECG
- Acquisizioni cardiache sincronizzate con ECG

**Riferimento:**
Constantinides CD, Atalar E, McVeigh ER. Signal-to-noise measurements in magnitude images from NMR phased arrays. Magnetic Resonance in Medicine 1997;38(5):852‚Äì857.

---

> [!nav]- Navigazione
> **Precedente:** [[4. Modello dell'Immagine Biomedica|‚Üê Modello Immagine]] | [[INDICE|üìë Indice]] | **Successivo:** [[6. Case Study - Bando CONSIP per Scanner MRI|Case Study CONSIP ‚Üí]]
